<%- include('./header') %>
<h1><%= title %></h1>
<%- include('../partials/flash-message') %>
<div class = "container mt-4">
    <!-- 10 customers/ page limit, starts from end of list -> start, so it displays the last page as the first page -->
        <ul style="list-style: none">
            <% customers.forEach(customer => { %>
            <li>
                <a href="./detail/<%=customer._id%>"><%= customer.name%></a>
                <a href="./edit/<%=customer._id%>">Edit</a>
                    </li>
            <% }); %>
        </ul>
        <p><%= totalCustomers %></p>
    </div>

     <%# --- PAGINATION CONTROLS --- %>
    <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
        <nav aria-label="Customer Pagination">
            <ul class="pagination justify-content-center">
                <%# "Previous" page link %>
                <% if (currentPage > 1) { %>
                    <li class="page-item">
                        <%# Construct query string, ensuring all existing filters/sorts are preserved %>
                        <a class="page-link" href="/customer?page=<%= currentPage - 1 %>&search=<%= searchQuery || '' %>&status=<%= currentStatus || '' %>&sortBy=<%= currentSortBy || 'createdAt' %>&sortOrder=<%= currentSortOrder || 'desc' %>">Previous</a>
                    </li>
                <% } else { %>
                    <li class="page-item disabled">
                        <span class="page-link">Previous</span>
                    </li>
                <% } %>

                <%# Page number links (simple example) %>
                <% for (let i = 1; i <= totalPages; i++) { %>
                    <% if (i === currentPage) { %>
                        <li class="page-item active" aria-current="page">
                            <span class="page-link"><%= i %></span>
                        </li>
                    <% } else { %>
                        <li class="page-item">
                            <a class="page-link" href="/customer?page=<%= i %>&search=<%= searchQuery || '' %>&status=<%= currentStatus || '' %>&sortBy=<%= currentSortBy || 'createdAt' %>&sortOrder=<%= currentSortOrder || 'desc' %>"><%= i %></a>
                        </li>
                    <% } %>
                <% } %>

                <%# "Next" page link %>
                <% if (currentPage < totalPages) { %>
                    <li class="page-item">
                        <a class="page-link" href="/customer?page=<%= currentPage + 1 %>&search=<%= searchQuery || '' %>&status=<%= currentStatus || '' %>&sortBy=<%= currentSortBy || 'createdAt' %>&sortOrder=<%= currentSortOrder || 'desc' %>">Next</a>
                    </li>
                <% } else { %>
                    <li class="page-item disabled">
                        <span class="page-link">Next</span>
                    </li>
                <% } %>
            </ul>
        </nav>
        <p class="text-center">Page <%= currentPage %> of <%= totalPages %> (Total Customers: <%= typeof totalCustomers !== 'undefined' ? totalCustomers : 'N/A' %>)</p>
    <% } else if (typeof totalCustomers !== 'undefined' && totalCustomers > 0) { %>
        <p class="text-center">Total Customers: <%= totalCustomers %></p>
    <% } %>
    
    <div class="mt-3">
        <a href="/customer/create" class="btn btn-success">Add New Customer</a>
    </div>

</div>
<%- include('../partials/footer') %>